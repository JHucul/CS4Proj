<!DOCTYPE html>
<html lang="en">
<head>
    <title>Chat</title>
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>

</head>
<body>
  <a href="/">Sign In</a>
  |
  <a href="/Chat">Chat</a>
  |
  <a href="/CreateChat">Create Chat</a>

  <br>
  <h1><u>Global Chat</u></h1>

  <input type="button" id="global1" value="Global Chat 1" onclick="ChangeChat(0)">
  <input type="button" id="global2" value="Global Chat 2" onclick="ChangeChat(1)">
  <input type="button" id="global3" value="Global Chat 3" onclick="ChangeChat(2)">

  <br>
  <br>
  <label for="nameInput">Your Name:</label>
  <input type="text" id="nameInput" value="Name">
  <br>
  <br>
  <textarea id="textDisplay" rows="20" cols="50" readonly></textarea>
  <br>
  <br>
  <label for="input">Your Message:</label>
  <input type="text" id="input">
  <input type="button" id="sendBut" value="Send">
  <input type="button" id="clearBut" value="Clear Log">

<script>
  	setInterval(ShowTextLogBut, 500);

    function ShowTextLog(data){
    	$("#textDisplay").val(data.textLog);
    	if(document.getElementById("textDisplay").scrollTop >= document.getElementById("textDisplay").scrollHeight - document.getElementById("textDisplay").scrollHeight*.5)
			document.getElementById("textDisplay").scrollTop = document.getElementById("textDisplay").scrollHeight
    }
    function ShowTextLogBut(data){
      	$.get("/getTextLogText", null, ShowTextLog);
    }
    function InputText(){
    	if($("#input").val() != "" && $("#nameInput").val() != "" && $("#nameInput").val() != "Name"){
        $.post('/setTextLogText', {text:"\n" + $("#nameInput").val() + "\n" + $("#input").val()+ "\n"}, null)
          $.get("/getTextLogText", null, ShowTextLog);
        }
        else if($("#input").val() == "")
          alert("You need to input somthing to send")
        else if($("#nameInput").val() == "" || $("#nameInput").val() == "Name")
          alert("You need to input your name")
    }
    function ClearTextLog(data){
      	$.post("/clearTextLogText", null, null);
      	ShowTextLogBut();
    }
    function ChangeChat(num){
      $.post("/ChangeChat", {number:num}, null);
      ShowTextLogBut();
      document.getElementById("textDisplay").scrollTop = document.getElementById("textDisplay").scrollHeight
    }

  	window.onload = function NewFunction() {
  		document.getElementById("textDisplay").scrollTop = document.getElementById("textDisplay").scrollHeight
    }
    $(document).ready(function(){ 
      $.get("/getTextLogText", null, ShowTextLog);
      $("#sendBut").click(InputText);
      $("#clearBut").click(ClearTextLog);
      $('#input').keydown(function(e){
	    if(e.keyCode === 13){
	    	InputText();
	     }  
	   });
    });     


</script>
</body>
</html>